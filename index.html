<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ë°ë¸”ìŠ¤ í”Œëœ ê¸°ì‚¬ì˜ ì—¬í–‰ ê²Œì„</title>
  <style>
    * { box-sizing: border-box; }
    body {
      font-family: "Pretendard", Arial, sans-serif;
      background: #f7f7f7;
      margin: 0;
      padding: 2rem 1rem;
      text-align: center;
    }

    h1 { margin-top: 0; }

    #controls {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 0.5rem;
      margin-bottom: 1rem;
    }

    select, button {
      padding: 0.4rem 0.8rem;
      font-size: 1rem;
      border: 1px solid #bbb;
      border-radius: 6px;
      cursor: pointer;
    }

    button:disabled {
      cursor: not-allowed;
      opacity: 0.6;
    }

    #board {
      display: grid;
      gap: 2px;
      justify-content: center;
      margin: 0 auto;
      max-width: 90vw;
    }

    .cell {
      width: 90px;   /* 1.5ë°° í™•ëŒ€ */
      height: 90px;  /* 1.5ë°° í™•ëŒ€ */
      background: #fff;
      border: 1px solid #999;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.2rem;
      user-select: none;
    }

    /* ìƒ‰ìƒ íŒ”ë ˆíŠ¸ ê°œì„  */
    .cell.valid   { background: #2d6a4f;  color: #fff; }  /* ê°€ëŠ¥í•œ ì´ë™ â€“ ë‹¤í¬ ê·¸ë¦° */
    .cell.hint    { background: #e63946;  color: #fff; }  /* íŒíŠ¸ â€“ ë ˆë“œ */
    .cell.visited { background: #a0c4ff; }               /* ë°©ë¬¸ â€“ íŒŒìŠ¤í…” ë¸”ë£¨ */

    #status { margin-top: 1rem; font-weight: 600; }
  </style>
</head>
<body>
  <h1>ë°ë¸”ìŠ¤ í”Œëœ ê¸°ì‚¬ì˜ ì—¬í–‰ ê²Œì„</h1>

  <div id="controls">
    <label>
      ì²´ìŠ¤íŒ í¬ê¸° :
      <select id="sizeSelect">
        <option value="5">5 Ã— 5</option>
        <option value="6">6 Ã— 6</option>
        <option value="7">7 Ã— 7</option>
        <option value="8">8 Ã— 8</option>
      </select>
    </label>
    <button id="startBtn">ê²Œì„ ì‹œì‘</button>
    <button id="undoBtn"  disabled>ë’¤ë¡œ ê°€ê¸°</button>
    <button id="hintBtn"  disabled>íŒíŠ¸ ë³´ê¸°</button>
  </div>

  <div id="board"></div>
  <div id="status"></div>
  <!-- ğŸ”— ê³µëµ ë§í¬ -->
  <div id="guide" style="margin-top:0.5rem">
    ê²Œì„ ê³µëµì´ í•„ìš”í•˜ë‹¤ë©´ <a href="https://blog.naver.com/kimsol1015/223862326616" target="_blank">ì—¬ê¸°ë¥¼ ì°¸ê³ í•˜ì„¸ìš”</a>.
  </div>

  <script>
    /* ---------------- ê³µí†µ ìƒíƒœ ---------------- */
    const boardEl      = document.getElementById("board");
    const sizeSelectEl = document.getElementById("sizeSelect");
    const startBtn     = document.getElementById("startBtn");
    const undoBtn      = document.getElementById("undoBtn");
    const hintBtn      = document.getElementById("hintBtn");
    const statusEl     = document.getElementById("status");

    const KNIGHT_DIRS = [
      {dx:  1, dy:  2}, {dx:  2, dy:  1}, {dx:  2, dy: -1}, {dx:  1, dy: -2},
      {dx: -1, dy: -2}, {dx: -2, dy: -1}, {dx: -2, dy:  1}, {dx: -1, dy:  2},
    ];

    let N            = 5;            // ì²´ìŠ¤íŒ í•œ ë³€ ê¸¸ì´
    let visited      = [];           // ë°©ë¬¸ ì—¬ë¶€ 2ì°¨ì› ë°°ì—´
    let moveStack    = [];           // {x, y} ê°ì²´ ë°°ì—´ â€“ ë’¤ë¡œê°€ê¸°ìš© ìŠ¤íƒ
    let currentPos   = {x: 0, y: 0}; // í˜„ì¬ ë§ ìœ„ì¹˜

    /* ---------------- ì´ˆê¸°í™” / ë Œë”ë§ ---------------- */
    function initBoard(size) {
      N = size;
      visited   = Array.from({ length: N }, () => Array(N).fill(false));
      moveStack = [];
      currentPos = { x: 0, y: 0 };
      visited[0][0] = true;
      moveStack.push({ x: 0, y: 0 });

      boardEl.style.gridTemplateColumns = `repeat(${N}, 90px)`;  // 1.5ë°° í™•ëŒ€
      renderBoard();
      updateHighlights();
      updateStatus();

      undoBtn.disabled = false;
      hintBtn.disabled = false;
    }

    function renderBoard() {
      boardEl.innerHTML = "";
      for (let y = 0; y < N; y++) {
        for (let x = 0; x < N; x++) {
          const cell = document.createElement("div");
          cell.className = "cell";
          cell.dataset.x = x;
          cell.dataset.y = y;

          if (visited[y][x]) {
            cell.classList.add("visited");
            const idx = moveStack.findIndex(p => p.x === x && p.y === y);
            cell.textContent = idx >= 0 ? idx + 1 : "";
          }
          boardEl.appendChild(cell);
        }
      }
    }

    /* ---------------- ìœ íš¨ ì´ë™, í•˜ì´ë¼ì´íŠ¸ ---------------- */
    function isValidMove(x, y) {
      return (
        x >= 0 && y >= 0 && x < N && y < N && !visited[y][x]
      );
    }

    function updateHighlights() {
      document.querySelectorAll(".cell").forEach(c => c.classList.remove("valid", "hint"));
      KNIGHT_DIRS.forEach(({ dx, dy }) => {
        const nx = currentPos.x + dx;
        const ny = currentPos.y + dy;
        if (isValidMove(nx, ny)) {
          const cell = document.querySelector(`.cell[data-x='${nx}'][data-y='${ny}']`);
          if (cell) cell.classList.add("valid");
        }
      });
    }

    /* ---------------- ê²Œì„ ì§„í–‰ ---------------- */
    function makeMove(x, y) {
      currentPos = { x, y };
      visited[y][x] = true;
      moveStack.push({ x, y });
      renderBoard();
      updateHighlights();
      updateStatus();
    }

    function undoMove() {
      if (moveStack.length <= 1) return; // ì‹œì‘ ì¹¸ì€ ë‚¨ê²¨ë‘ 
      const last = moveStack.pop();
      visited[last.y][last.x] = false;
      currentPos = moveStack[moveStack.length - 1];
      renderBoard();
      updateHighlights();
      updateStatus();
    }

    function updateStatus() {
      const total = N * N;
      const visitedCnt = moveStack.length;
      statusEl.textContent = `ì´ë™ íšŸìˆ˜: ${visitedCnt} / ${total}`;

      // ì„±ê³µ íŒë‹¨
      if (visitedCnt === total) {
        alert("ì„±ê³µí–ˆìŠµë‹ˆë‹¤! ğŸ‰");
        undoBtn.disabled = true;
        hintBtn.disabled = true;
        return;
      }

      // ì‹¤íŒ¨ íŒë‹¨ â€“ ë” ê°ˆ ê³³ì´ ì—†ìŒ
      const hasMove = KNIGHT_DIRS.some(({ dx, dy }) => isValidMove(currentPos.x + dx, currentPos.y + dy));
      if (!hasMove) {
        alert("ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ë„ì „í•´ ë³´ì„¸ìš”!");
        undoBtn.disabled = true;
        hintBtn.disabled = true;
      }
    }

    /* ---------------- íŒíŠ¸ (ë°±íŠ¸ë˜í‚¹) ---------------- */
    function countOnward(x, y, visitedArr) {
      return KNIGHT_DIRS.filter(({ dx, dy }) => {
        const nx = x + dx, ny = y + dy;
        return nx >= 0 && ny >= 0 && nx < N && ny < N && !visitedArr[ny][nx];
      }).length;
    }

    function findTourPath() {
      // ê¹Šì€ ë³µì‚¬ & Warnsdorff + ë°±íŠ¸ë˜í‚¹
      const v = visited.map(row => row.slice());
      const path = moveStack.slice();

      function dfs(x, y, cnt) {
        if (cnt === N * N) return true;
        const moves = KNIGHT_DIRS
          .map(({ dx, dy }) => ({ x: x + dx, y: y + dy }))
          .filter(p => p.x >= 0 && p.y >= 0 && p.x < N && p.y < N && !v[p.y][p.x])
          .sort((a, b) => countOnward(a.x, a.y, v) - countOnward(b.x, b.y, v));

        for (const m of moves) {
          v[m.y][m.x] = true;
          path.push(m);
          if (dfs(m.x, m.y, cnt + 1)) return true;
          path.pop();
          v[m.y][m.x] = false;
        }
        return false;
      }

      if (dfs(currentPos.x, currentPos.y, moveStack.length)) {
        return path; // ì „ì²´ ê²½ë¡œ
      }
      return null; // ë¶ˆê°€
    }

    function showHint() {
      const fullPath = findTourPath();
      if (fullPath && fullPath.length > moveStack.length) {
        const next = fullPath[moveStack.length];
        const cell = document.querySelector(`.cell[data-x='${next.x}'][data-y='${next.y}']`);
        if (cell) cell.classList.add("hint");
      } else {
        alert("ì„±ê³µí•  ìˆ˜ ìˆëŠ” ê²½ë¡œê°€ ì—†ìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ ë³´ì„¸ìš”! ğŸ™");
      }
    }

    /* ---------------- ì´ë²¤íŠ¸ ë°”ì¸ë”© ---------------- */
    boardEl.addEventListener("click", e => {
      const cell = e.target.closest(".cell");
      if (!cell || !cell.classList.contains("valid")) return;
      const x = +cell.dataset.x;
      const y = +cell.dataset.y;
      makeMove(x, y);
    });

    startBtn.addEventListener("click", () => initBoard(+sizeSelectEl.value));
    undoBtn.addEventListener("click", undoMove);
    hintBtn.addEventListener("click", showHint);

    // ìµœì´ˆ 5Ã—5 ë³´ë“œ ìë™ ìƒì„±
    initBoard(5);
  </script>
</body>
</html>
